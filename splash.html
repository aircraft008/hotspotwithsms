<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>麻辣印象 &middot; 免费无线网络</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="Hotspot">
		<meta name="author" content="Leon Zhuang">

		<!-- Le styles -->
		<link href="css/bootstrap.css" rel="stylesheet">
		<style type="text/css">
			body {
				padding-top: 20px;
				padding-bottom: 40px;
				font-family: "Microsoft YaHei","Trebuchet MS","Myriad Pro",Arial,sans-serif;
			}

			/* Custom container */
			.container-narrow {
				margin: 0 auto;
				max-width: 700px;
			}
			.container-narrow > hr {
				margin: 30px 0;
			}

			/* Main marketing message and sign up button */
			.jumbotron {
				margin: 60px 0;
				text-align: center;
			}
			.jumbotron h1 {
				font-size: 72px;
				line-height: 1;
			}
			.jumbotron .btn {
				font-size: 21px;
				padding: 14px 24px;
			}

			/* Supporting marketing content */
			.marketing {
				margin: 60px 0;
			}
			.marketing p + h4 {
				margin-top: 28px;
			}

			.msginfo {
				color: blue;
			}
			.msgerro {
				color: red;
			}
		</style>
		<link href="css/bootstrap-responsive.css" rel="stylesheet">

		<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
		  <script src="js/html5shiv.js"></script>
		<![endif]-->

		<!-- Fav and touch icons -->
		<!-- 
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
		<link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
		<link rel="shortcut icon" href="../assets/ico/favicon.png"> -->
	</head>

	<body>

		<div class="container-narrow">

			<div class="masthead">
				<ul class="nav nav-pills pull-right">
					<li class="active"><a href="#">新浪微博</a></li>
					<li class="active"><a href="#">帮助</a></li>
				</ul>
				<h3 class="muted">麻辣印象 &middot; 免费无线网络 &middot; 登录</h3>
			</div>

			<hr>

			<div class="jumbotron">
				<h1>Super awesome marketing speak!</h1>
				<p class="lead">Cras justo odio, dapibus ac facilisis in, egestas eget quam. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>
			</div>

			<hr>

			<div class="row-fluid marketing">
				<div class="span6">
					<form  action="###" autocomplete="on" method="post" id="sendmobile"> 
						<h4>1.输入手机号码</h4>
						<p> 
							<label>用于接收动态短信验证码</label>
							<input id="mobile" name="mobile" type="text" placeholder=""/>
						</p>
						<p>
							<input class="btn btn-success" id="sendsms" type="submit" value="获取" />
							<span id="sendstatus"></span>
						</p>
					</form>

					<form  action="$action" autocomplete="on" method="post" id="auth">
						<h4>2.输入短信验证码</h4>
						<p> 
							<label>6位数字</label>
							<input id="smspass" name="smspass" type="text" placeholder="" disabled="disabled" />
						</p>
						<p>
							<input class="btn btn-success" id="submit" type="submit" value="登陆" disabled="disabled" />
							<span id="authstatus"></span>
						</p>

						<input type="hidden" name="auths" id="auths" value="" />
						<input type="hidden" name="mode_login">
						<input type="hidden" name="redirect" value="$redirect">
						<input type="hidden" name="accept_terms" value="yes">
					</form>
				</div>

				<div class="span6">
					<h4>Subheading</h4>
					<p>Donec id elit non mi porta gravida at eget metus. Maecenas faucibus mollis interdum.</p>

					<h4>Subheading</h4>
					<p>Morbi leo risus, porta ac consectetur ac, vestibulum at eros. Cras mattis consectetur purus sit amet fermentum.</p>

					<h4>Subheading</h4>
					<p>Maecenas sed diam eget risus varius blandit sit amet non magna.</p>
				</div>
			</div>

			<hr>

			<div class="footer">
				<p>&copy; 麻辣印象 2013 | Powered by <a herf="http://nerrsoft.com" target="_blank">Nerrsoft.com</a></p>
			</div>

		</div> <!-- /container -->



		<!-- Le javascript
		================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="js/jquery.js"></script>
		<script src="js/js/bootstrap.min.js"></script>
		<!-- <script src="js/jquery.jsonp-2.4.0.min"></script> -->

		<!-- js -->
		<script type="text/javascript">
			$(document).ready(function(){
				//-- send mobile phone number
				var mpformat = /(^0{0,1}1[3|4|5|6|7|8|9][0-9]{9}$)/;
				$('#sendmobile').submit(function(){
					var mp = $.trim($('#mobile').val());
					if(!mp.match(mpformat))
						$('#sendstatus').html('请确认您的手机号码').attr('class', 'msgerro');
					else
					{
						$('#mobile').attr('disabled', 'disabled');
						$('#sendsms').attr('disabled', 'disabled');
						$('#sendstatus').text('请稍候').attr('class', 'msginfo');

						var url = "http://192.168.7.105/hotspot/serv/auth.php?action=step1&mobile="+mp+"&callback=?";
						$.getJSON(url, function(data){
							if(data.status==true)
							{
								$('#sendstatus').text('短信发送成功,请查收').attr('class', 'msginfo');

								if($('#smspass').attr('disabled')=='disabled')
									$('#smspass').attr('disabled', false);
								if($('#submit').attr('disabled')=='disabled')
									$('#submit').attr('disabled', false);
							}
						});
					}
					return false;
				});

				//-- check sms pass
				var spformat = /(^[0-9]{6}$)/;
				$('#auth').submit(function(){
					$('#authstatus').text('请稍后').attr('class', 'msginfo');

					var smspass = $.trim($('#smspass').val());
					var mp = $.trim($('#mobile').val());

					if(!smspass.match(spformat))
					{
						$('#authstatus').text('验证码格式不正确').attr('class', 'msgerro');
						return false;
					}




					/*//$.ajaxSetting.async = false; 
					var url = "http://192.168.2.2/hotspot/serv/auth.php?action=step2&mobile="+mp+"&smspass="+smspass+"&callback=?";


					$.ajaxSettings.async = false; 
					$.getJSON(url, function(data){
						if(data.status == true)
						{
							$('#authstatus').text('验证成功').attr('class', 'msginfo');
							$('#auths').val('OK');
						}
						else
							$('#authstatus').text(data.message).attr('class', 'msgerro');
					});*/


					/*//after  
					$.ajax({  
						url: url,
						dataType: 'text',  
						data: 'text',  
						async: false,  
						success: function(json){  
							//success code  
						}  
					});*/

					/*var url = "http://192.168.2.2/hotspot/serv/auth.php";
					var param = {};
					param.mobile = mp;
					param.smspass= smspass;
					param.action = step2;


					$.ajax({
						async: false, 
						type: 'get',
						url:  url,
						data: param,
						dataType: 'jsonp',
						error: function(){
							alert('fail');
						},  
						success: function(data){  
							 if(data.status == true)
							{
								$('#authstatus').text('验证成功').attr('class', 'msginfo');
								$('#auths').val('OK');
							}
							else
								$('#authstatus').text(data.message).attr('class', 'msgerro');
							}  
					});*/
					// 初始化数据，同一个cookie一分钟的访问量都算一次
					var j = null;
					$.ajax({
						async: false,
						type: "get",
						dataType: "jsonp",
						jsonp:"callback",
						url: "http://192.168.7.105/hotspot/serv/auth.php",
						data:{"action":"step2", "smspass":smspass, "mobile":mp},
						success: function(data){
							j = data;
							//alert(data.status);
							if(data.status == true)
							{
								$('#authstatus').text('验证成功').attr('class', 'msginfo');
								//$('#auths').val('OK');
							}
							else
							{
								$('#authstatus').text(data.message).attr('class', 'msgerro');
								return false;
							}
						},
					})

					alert(j.status);

					/*if($('#auths').val()!='OK')
					{
						return false;
					}*/
				});
			});
		</script>

	</body>
</html>